

<!doctype html>
<html lang="en-US" >

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>
        
        Hello Django
         | bhg995
        
    </title>
    <meta property="og:title" content="IT &amp; Security Projects" />
    <meta property="og:locale" content="en_US" />
    <meta name="description" content="Cool framework">
    <link rel="canonical" href="http://localhost:4000/" />
    <meta property="og:url" content="http://localhost:4000/" />
    <meta property="og:site_name" content="IT" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary" />
    <meta property="twitter:title" content="IT &amp; Security Projects Portfolio" />
    <script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebSite","description":"Programming, Configuration Management, and Computer Security — including projects and reports.","headline":"IT &amp; Security Projects Portfolio","name":"IT","url":"http://localhost:4000/"}</script>
    <!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=5102d6906bec8de3cf54d5eae2973d5cf40a3a9b">
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous"> -->
    <script src="https://code.jquery.com/jquery-3.3.0.min.js"
        integrity="sha256-RTQy8VOmNlT6b2PIRur37p6JEBZUE7o8wPgMvu18MC4=" crossorigin="anonymous"></script>
    <script src="/assets/js/main.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

    <!-- Setup Google Analytics -->
     
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JMZC2X9CQD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-JMZC2X9CQD');
</script>
 
    <!-- favicon -->
    <!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->
</head>

<body>

    <!-- <header>
        <h1>IT & Security Projects Portfolio</h1>
        <p>Programming, Configuration Management, and Computer Security — including projects and reports.</p>
    </header> -->

    <header>
        <h1>Hello Django</h1>
        
        <p>Cool framework</p>
        
        
    </header>
      <nav>
        <ul></ul>
      </nav>
    <div id="banner" style="width:100%;">
        <!-- <a href="#" class="button fork"><strong>link</strong></a> -->
    </div>
    <div class="wrapper">
        <section>
            <p><a href="/linux">Previous Page</a></p>

<h1 id="hello-django">Hello Django</h1>

<h2 id="django"><a href="https://www.djangoproject.com/">Django</a></h2>

<p>“<em>Django is a high-level Python web framework that encourages rapid development and clean, pragmatic design. Built by experienced developers, it takes care of much of the hassle of web development, so you can focus on writing your app without needing to reinvent the wheel. It’s free and open source.</em>” - Django [<a href="https://www.djangoproject.com/">1</a>]</p>

<p>“<em>Django is a free and open-source, Python-based web framework that runs on a web server. It follows the model–template–views architectural pattern. It is maintained by the Django Software Foundation, an independent organization established in the US as a 501 non-profit.</em>” - Wikipedia [<a href="https://en.wikipedia.org/wiki/Django_(web_framework)">2</a>]</p>

<p>Avoimeen lähteeseen perustuva Django on web-kehys joka toimii Pythonilla. Django on helppo käyttää ja ottaa käyttöön, ja Django tarjoaa kaiken mahdollisen tarvittavan ohjelmiston tai web-sovelluksen kehitykseen. [<a href="https://www.tieturi.fi/koulutusala/ohjelmistokehitys/ohjelmoinnin-viitekehykset/">3</a>]</p>

<h2 id="postgresql"><a href="https://www.postgresql.org/">PostgreSQL</a></h2>

<p>“<em>PostgreSQL (pgsql) on SQL-kieltä tukeva avoimen lähdekoodin tietokantamoottori.</em>” - Linux.fi-wiki [<a href="https://www.linux.fi/wiki/PostgreSQL">4</a>]</p>

<h1 id="laitteisto">Laitteisto</h1>

<ul>
  <li>Näyttö: AOC G2490VXA, 24” QHD(1440p), 144Hz</li>
  <li>Raspberry Pi 4 model B 4 Gt</li>
  <li>Käyttöjärjestelmä: Raspberry Pi OS 32bit kernel (based on Debian)</li>
  <li>CPU: Broadcom BCM2711 SoC with a 1.8 GHz 64-bit quad-core ARM Cortex-A72 processor, with 1 MB shared L2 cache.</li>
  <li>Näytönohjain: Broadcom VideoCore VI @ 500 MHz</li>
  <li>Muisti: 4 Gt</li>
  <li>Tallennustila: 32 Gt</li>
</ul>

<h1 id="tehtävät">Tehtävät</h1>

<h2 id="a-tee-yksinkertainen-esimerkkiohjelma-djangolla">a) Tee yksinkertainen esimerkkiohjelma Djangolla.</h2>

<p>Aloitin tehtävän la 28.9 klo 11:25</p>

<p>Minulla oli tehtävää varten valmiina virtuaalinen palvelin.</p>

<p>Tein <a href="https://github.com/bhg995/lise/blob/main/h4/maailmaKuulee.md#b-tee-alkutoimet-omalla-virtuaalipalvelimellasi-klo-1850">alkutoimet</a>.</p>

<p>Seurasin opettajan ohjeita: Django 4 Instant Customer Database Tutorial. [<a href="https://terokarvinen.com/2022/django-instant-crm-tutorial/?fromSearch=django">5</a>]</p>

<p>Asensin virtuaaliympäristön palvelintietokoneelle:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get -y install virtualenv
</code></pre></div></div>

<p>Tein uuden ympäristön Djangoa varten:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>virtualenv --system-site-packages -p python3 env/
</code></pre></div></div>

<p><img src="https://github.com/user-attachments/assets/4028c7e0-8b8d-4c07-aa55-a3e3d4b03821" alt="Näyttökuva 2024-9-28 kello 11 53 09" /></p>

<p>Nyt minulla oli uusi kansio <code class="language-plaintext highlighter-rouge">env/</code>, jossa tarvittavat paketit. Otin uuden ympäristön käyttöön komennolla:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source env/bin/activate
</code></pre></div></div>

<p>Käyttäjätunnukseni edessä lukee (env), käytän eri ympäristöä.</p>

<p><img src="https://github.com/user-attachments/assets/d974dc28-2de8-4836-9d4b-06098f4d28c0" alt="Näyttökuva 2024-9-28 kello 11 56 58" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>which pip
/home/leonardo/env/bin/pip
</code></pre></div></div>

<p>Minulla oli jo Micro editori, versio <code class="language-plaintext highlighter-rouge">2.0.11</code></p>

<p>Tein microdokumentti requirements.txt, kirjoitin  <code class="language-plaintext highlighter-rouge">django</code>, ja tallensin sen virtuaaliympäristöön</p>

<p>Sen jälkeen komento:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install -r requirements.txt
</code></pre></div></div>

<p>Sain ladattua djangon</p>

<p><img src="https://github.com/user-attachments/assets/1b63967e-7b2e-4dd7-a0f3-5874379144af" alt="Näyttökuva 2024-9-28 kello 12 11 13" /></p>

<p><img src="https://github.com/user-attachments/assets/8d1e14bc-497b-44c0-93e3-595b32633733" alt="Näyttökuva 2024-9-28 kello 12 18 30" /></p>

<p><img src="https://github.com/user-attachments/assets/549a2d48-cbab-42fb-9691-14937bed6c98" alt="Näyttökuva 2024-9-28 kello 12 26 55" /></p>

<h3 id="tietokanta">Tietokanta</h3>

<p><img src="https://github.com/user-attachments/assets/3f62a1ce-a272-49ad-a5fd-8afcc3d982c9" alt="Näyttökuva 2024-9-28 kello 12 27 57" /></p>

<p><img src="https://github.com/user-attachments/assets/dfcee407-998b-45f9-881a-c94081fb9b2a" alt="Näyttökuva 2024-9-28 kello 12 25 58" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>micro crm/models.py
</code></pre></div></div>

<p>Lisäsin models.py esimerkkikoodia opettajan esimerkistä:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from django.db import models

class Customer(models.Model):
    name = models.CharField(max_length=160)

    def __str__(self):		
        return self.name	
</code></pre></div></div>

<p>Lähde terokarvinen.com. [<a href="https://terokarvinen.com/2022/django-instant-crm-tutorial/">6</a>]</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./manage.py makemigrations
./manage.py migrate
</code></pre></div></div>

<p><img src="https://github.com/user-attachments/assets/ac481f01-48ed-4da0-83e4-7854f4feacd9" alt="Näyttökuva 2024-9-28 kello 12 41 03" /></p>

<p>Rekisteröin tietokannan:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>micro crm/admin.py
</code></pre></div></div>

<p>ja lisäsin tiedostoon seuraavan pätkän:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>admin.site.register(models.Customer)
</code></pre></div></div>

<p>Lähde terokarvinen.com. [<a href="https://terokarvinen.com/2022/django-instant-crm-tutorial/">6</a>]</p>

<p>Olin lukenut opettajan ohjeet loppuun, tässä vaiheessa halusin kokeilla mitä sain aikaiseksi.</p>

<p>Käytin komentoa:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./manage.py runserver
</code></pre></div></div>

<p>Sain virheviestin</p>

<p><img src="https://github.com/user-attachments/assets/64b9f6ed-29e2-417e-ad9b-32918036c00d" alt="Näyttökuva 2024-9-28 kello 12 51 07" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    admin.site.register(models.Customer)
                    ^^^^^^
    NameError: name 'models' is not defined
</code></pre></div></div>

<p>Koodipätkä on tiedostossa <code class="language-plaintext highlighter-rouge">crm/admin.py</code>. Koodista puuttui <code class="language-plaintext highlighter-rouge">from . import models</code>. Lisäsin sen</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from django.contrib import admin
from . import models

admin.site.register(models.Customer)
</code></pre></div></div>

<p>Tarkistin uudelleen:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./manage.py runserver
</code></pre></div></div>

<p>Sain tulokseksi:</p>

<p><img src="https://github.com/user-attachments/assets/db5b6237-8bfd-4800-bbb8-b075264bce5a" alt="Näyttökuva 2024-9-28 kello 13 02 21" /></p>

<p>Tässä vaiheessa en ollut varma että toimiiko Django niinkuin pitäisi.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -s localhost|grep title # access without GUI
</code></pre></div></div>

<p>Sain osoitteen <code class="language-plaintext highlighter-rouge">http://127.0.0.1:8000/</code> josta olisin voin tarkistaa selaimella, mutta käytän Djangoa palvelimen kautta. Curl komennolla pitäisi näkyä että näkyykö sivu, mutta saan virheviestin:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl: (7) Failed to connect to 127.0.0.1 port 8000 after 0 ms: Couldn't connect to server
</code></pre></div></div>

<p>Klo 13:05 otan taukoa, ja palaan myöhemmin kokeilemaan eri keinoja, joilla saisin Django käynnistymään oikein.</p>

<p>Klo 15:55 aloitin uudelleen.</p>

<p>Päätin yrittää Djangon käynnistystä paikallisesti, Raspberry Pi -tietokoneella.</p>

<p>Aloitin käymällä läpi seuraavat sivut</p>

<ul>
  <li>https://docs.djangoproject.com/en/5.1/intro/tutorial01/</li>
  <li>https://pimylifeup.com/raspberry-pi-django/</li>
</ul>

<p>Seurasin opettajan ohjeita uudelleen. Käynnistys näytti onnistuvan.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./manage.py runserver

Watching for file changes with StatReloader
Performing system checks...

System check identified no issues (0 silenced).

You have 18 unapplied migration(s). Your project may not work properly until you apply the migrations for app(s): admin, auth, contenttypes, sessions.
Run 'python manage.py migrate' to apply them.
September 27, 2024 - 17:29:11
Django version 5.1.1, using settings 'folder.settings'
Starting development server at http://127.0.0.1:8000/
Quit the server with CONTROL-C.
</code></pre></div></div>

<p>Selaimessa kuitenkin:</p>

<p><img src="https://github.com/user-attachments/assets/5b952b1b-4de3-4424-8248-adc17445e861" alt="Näyttökuva _1" /></p>

<p>Lopetin 28.9 17:35</p>

<p>Tulin illemmalla takaisin, kokeilin vielä kerran Djangon käyttöönottoa onnistumatta.</p>

<p>Päätin aloittaa tyhjältä pöydältä.</p>

<p>Poistin Djangon, sille luomani ympäristön ja Apachen. Epäilin että Apachella olisi vaikutusta. # https://stackoverflow.com/questions/30670759/run-django-without-apache-using-runserver-on-port-80-and-accessible-outside-lan</p>

<p>Sitten kokeilin uudestaan, seuraamalla opettajan ohjeita.</p>

<p><img src="https://github.com/user-attachments/assets/9c330bf9-1e7c-4f0d-85d1-55bb90c0609f" alt="Näyttökuva " /></p>

<p><img src="https://github.com/user-attachments/assets/ab17daf1-ee9d-4b05-b9f0-68f3c2c89ff8" alt="Näyttökuva 2" /></p>

<p><img src="https://github.com/user-attachments/assets/d4488fdb-59bc-4f55-9116-a048ba5dfa01" alt="Näyttökuva 3" /></p>

<p>29.9 klo 0:11 Djangon raketti näkyi selaimella.</p>

<p><strong>CRM</strong></p>

<p><img src="https://github.com/user-attachments/assets/9fe2af18-29f8-4a57-b558-269d77d6d303" alt="Näyttökuva 4" /></p>

<p>Tässä välissä tein käyttäjän <code class="language-plaintext highlighter-rouge">leonardo</code></p>

<p><img src="https://github.com/user-attachments/assets/269d389c-e828-424f-a044-d8cdc0a3caa7" alt="Näyttökuva 5" /></p>

<p>Lisäsin <code class="language-plaintext highlighter-rouge">settings.py</code> tiedostoon rivin <code class="language-plaintext highlighter-rouge">'crm'</code></p>

<p><code class="language-plaintext highlighter-rouge">models.py</code> tiedostoon lisäsin python koodin:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from django.db import models

class Customer(models.Model):
    name = models.CharField(max_length=160)

    def __str__(self):		# new
        return self.name	# new
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">admin.py</code> tiedostoon:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from django.contrib import admin
from . import models

admin.site.register(models.Customer)
</code></pre></div></div>

<p>Yritin käynnistää Djangon, mutta sain virheviestin <code class="language-plaintext highlighter-rouge">Error: that port is already in use</code></p>

<p>Hain tietoa Googlesta, ja löysin ohjeen miten sulkea käynnissä olevat portit.</p>

<blockquote>
  <p>A more simple solution just type sudo fuser -k 8000/tcp. This should kill all the processes associated with port 8000.</p>
</blockquote>

<blockquote>
  <p>EDIT:</p>
</blockquote>

<blockquote>
  <table>
    <tbody>
      <tr>
        <td>For osx users you can use sudo lsof -t -i tcp:8000</td>
        <td>xargs kill -9</td>
      </tr>
    </tbody>
  </table>
</blockquote>

<blockquote>
  <p>edited Nov 17, 2015 at 12:49
answered Nov 27, 2013 at 10:53</p>
</blockquote>

<blockquote>
  <p><a href="https://stackoverflow.com/questions/20239232/django-server-error-port-is-already-in-use">Stackoverflow.com</a>, <a href="https://stackoverflow.com/users/935241/mounir">Mounir</a></p>
</blockquote>

<p>[<a href="https://stackoverflow.com/questions/20239232/django-server-error-port-is-already-in-use">7</a>] [<a href="https://man7.org/linux/man-pages/man2/kill.2.html">8</a>]</p>

<p>Kokeilin mitkä portit ovat estämässä. Vahingossa suljin selaimen, mutta samalla varmistuin että syntaksi toimii:</p>

<p><img src="https://github.com/user-attachments/assets/f3135e0c-9089-4db3-8d31-8568e036b1d9" alt="Näyttökuva 6" /></p>

<p><img src="https://github.com/user-attachments/assets/662b118d-2e08-40ed-b8e5-6a07bdc78f27" alt="Näyttökuva 7" /></p>

<p><img src="https://github.com/user-attachments/assets/e3b7ee7e-fe11-4ead-9daf-7335fdc45019" alt="Näyttökuva 8" /></p>

<p><img src="https://github.com/user-attachments/assets/1ff9ffc8-b0b9-438d-bee4-d7689d44cd74" alt="Näyttökuva 10" /></p>

<p>CRM toimii. Selailin Djangoa ja lisäsin uuden käyttäjän.</p>

<h2 id="b-tee-djangon-tuotantotyyppinen-asennus">b) Tee Djangon tuotantotyyppinen asennus</h2>

<p>Aloitin klo 29.9 22.24. Seuraan opettajan <a href="https://terokarvinen.com/2022/deploy-django/">ohjeita</a></p>

<p>Päivitin koneen ja käynnistän Apachen.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get update
sudo systemctl start apache2
</code></pre></div></div>

<p>Tein uuden kansion:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir -p publicwsgi//tuotantoDjango/static/
</code></pre></div></div>

<p>Valmistelin <code class="language-plaintext highlighter-rouge">.html</code> tiedoston:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo "Statically see you at llanga.live."|tee publicwsgi/tuotantoDjango/static/index.html
</code></pre></div></div>

<p>Lisäsin konfiguraatioasetuksiin polun</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Alias /static /home/uhse/publicwsgi/tuotantoDjango/static/
&lt;Directory /home/uhse/publicwsgi/tuotantoDjango/static/&gt;
    Require all granted
&lt;/Directory&gt;
</code></pre></div></div>

<p>Sivuasetukset:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo a2dissite 000-default.conf 
sudo a2ensite llanga.live.conf
</code></pre></div></div>

<p><img src="https://github.com/user-attachments/assets/f065c5a8-18ec-4d56-9e02-5a2aa40ee65d" alt="Näyttökuva 2024-9-29 kello 23 14 09" /></p>

<p><img src="https://github.com/user-attachments/assets/5d50d535-4bc6-4355-af41-2eafd97328cf" alt="Näyttökuva 2024-9-29 kello 23 14 53" /></p>

<p><strong>Django virtuaaliympäristön asennus</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo "Statically see you at llanga.live."|tee publicwsgi/tuotantoDjango/static/index.html
cd publicwsgi/
virtualenv -p python3 --system-site-packages env
source env/bin/activate
</code></pre></div></div>

<p>Pääsin virtuaaliympäristöön, josta pääsin asentamaan Djangon.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install -r requirements.txt

Successfully installed django-4.2.16
</code></pre></div></div>

<p>Sitten aloitin Django projektin:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>django-admin startproject tuotantoDjango
micro /etc/apache2/sites-available/llanga.live.conf
</code></pre></div></div>

<p>Muokkasin opettajan esimerkkiä ja vaihdoin kansion nimen, sekä polun:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Define TDIR /home/uhse/publicwsgi/tuotantoDjango
Define TWSGI /home/uhse/publicwsgi/tuotantoDjango/wsgi.py
Define TUSER uhse
Define TVENV /home/uhse/publicwsgi/env/lib/python3.9/site-packages


&lt;VirtualHost *:80&gt;
    Alias /static/ ${TDIR}/static/
    &lt;Directory ${TDIR}/static/&gt;
            Require all granted
    &lt;/Directory&gt;

    WSGIDaemonProcess ${TUSER} user=${TUSER} group=${TUSER} threads=5 python-path="${TDIR}:${TVENV}"
    WSGIScriptAlias / ${TWSGI}
    &lt;Directory ${TDIR}&gt;
         WSGIProcessGroup ${TUSER}
         WSGIApplicationGroup %{GLOBAL}
         WSGIScriptReloading On
         &lt;Files wsgi.py&gt;
            Require all granted
         &lt;/Files&gt;
    &lt;/Directory&gt;

&lt;/VirtualHost&gt;

Undefine TDIR
Undefine TWSGI
Undefine TUSER
Undefine TVENV
</code></pre></div></div>

<p>Apachen moduuli virtuaaliympäristössä:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get -y install libapache2-mod-wsgi-py3
/sbin/apache2ctl configtest
</code></pre></div></div>

<p><img src="https://github.com/user-attachments/assets/596af884-552a-49a0-b9c9-7d0d20e3ed20" alt="Näyttökuva 2024-9-29 kello 23 39 58" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo systemctl restart apache2
curl -s localhost|grep title
</code></pre></div></div>

<p>Virhe:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;title&gt;404 Not Found&lt;/title&gt;
</code></pre></div></div>

<p>Tarkistin lokista:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo tail -f /var/log/apache2/error.log
</code></pre></div></div>

<p>Loki:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Mon Sep 30 00:10:04.536650 2024] [wsgi:error] [pid 4838:tid 4847] [client ::1:59554] Target WSGI script not found or unable to stat: /home/uhse/publicwsgi/tuotantoDjango/wsgi.py
[Mon Sep 30 00:12:11.162752 2024] [wsgi:error] [pid 4838:tid 4852] [client 127.0.0.1:44910] Target WSGI script not found or unable to stat: /home/uhse/publicwsgi/tuotantoDjango/wsgi.py
</code></pre></div></div>

<p>Tarkemmin:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Target WSGI script not found or unable to stat: /home/uhse/publicwsgi/tuotantoDjango/wsgi.py
</code></pre></div></div>

<p>Eli Django ei päässyt käsiksi <code class="language-plaintext highlighter-rouge">wsgi.py</code> tiedostoon. Tarkistin missä tiedosto on -&gt; /home/uhse/publicwsgi/tuotantoDjango/tuotantoDjango/wsgi.py.</p>

<p>Ajoin <code class="language-plaintext highlighter-rouge">django-admin startproject</code> komennon <em>tuotantoDjango</em> kansion sisällä, joka loi uuden samannimisen kansion , jossa kyseinen tiedosto oli.</p>

<p>Kävin vaihtamassa <code class="language-plaintext highlighter-rouge">.conf</code> tiedostossa poluksi /home/uhse/publicwsgi/tuotantoDjango/tuotantoDjango/wsgi.py.</p>

<p><img src="https://github.com/user-attachments/assets/4f97f94c-af01-49b1-af95-b9c3600d2d3e" alt="Näyttökuva 2024-9-30 kello 0 29 48" /></p>

<p><img src="https://github.com/user-attachments/assets/3e20100d-d511-4025-bd88-4cdc212154a5" alt="Näyttökuva 2024-9-30 kello 0 31 53" /></p>

<p>Django käynnistyi.</p>

<p>Debug ottaminen pois käytöstä. Näin rikolliset tai muut eivät pääse näkemään tarkasti virheviestejä.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>micro tuotantoDjango/settings.py
</code></pre></div></div>

<p>Vaihdoin <code class="language-plaintext highlighter-rouge">ALLOWED_HOSTS</code> muuttujan <code class="language-plaintext highlighter-rouge">True</code>:ksi</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ALLOWED_HOSTS = ["localhost", "llanga.live"]
</code></pre></div></div>

<p>Sekä lisäsin:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import os
</code></pre></div></div>

<p>ja:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>STATIC_ROOT = os.path.join(BASE_DIR, 'static/')
</code></pre></div></div>

<p>Sen jälkeen:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>touch tuotantoDjango/wsgi.py
sudo systemctl restart apache2
</code></pre></div></div>

<p><img src="https://github.com/user-attachments/assets/c5e47f6a-1a3c-46ef-b1f0-da6867b5ef58" alt="Näyttökuva 2024-9-30 kello 0 38 59" /></p>

<p><img src="https://github.com/user-attachments/assets/1c8942a1-88bf-440c-be99-dde8767923dd" alt="Näyttökuva 2024-9-30 kello 0 59 08" /></p>

<p>Tein uuden käyttäjän <code class="language-plaintext highlighter-rouge">leonardo</code>, jotta pääsen käyttämään Djangoa.</p>

<p><img src="https://github.com/user-attachments/assets/814ce177-1bef-4569-befa-52f602a1857c" alt="Näyttökuva 2024-9-30 kello 1 01 01" /></p>

<p>Klo 01:00 tuotantotyyppinen Django oli valmis</p>

<p><img src="https://github.com/user-attachments/assets/d7abc332-7473-4f21-b8c7-822b097eb991" alt="Näyttökuva 2024-9-30 kello 1 03 14" /></p>

<h2 id="postgresql-1">PostgreSQL</h2>

<p>Tehtävä osoittautui hankalaksi, ja kokeilin CHATGPT.</p>

<p>Prompt:</p>

<blockquote>
  <p>PostgreSQL käyttöönotto Djangossa (env) ympäristössä</p>
</blockquote>

<p>Vastauksena sain ohjeet:</p>

<p>Asenna psycopg2-kirjasto, joka mahdollistaa Djangon yhteyden PostgreSQL:ään:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install psycopg2
</code></pre></div></div>

<p>Avaa projektisi settings.py-tiedosto ja muuta tietokantakonfiguraatiota PostgreSQL:ksi :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'your_db_name',
        'USER': 'your_db_user',
        'PASSWORD': 'your_db_password',
        'HOST': 'localhost',  # tai '127.0.0.1'
        'PORT': '5432',       # Oletusportti
    }
}
</code></pre></div></div>

<p>Siirry PostgreSQL komentoikkunaan:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo -u postgres psql
</code></pre></div></div>

<p>Luo uusi tietokanta:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE DATABASE your_db_name;
CREATE USER your_db_user WITH PASSWORD 'your_db_password';
ALTER ROLE your_db_user SET client_encoding TO 'utf8';
ALTER ROLE your_db_user SET default_transaction_isolation TO 'read committed';
ALTER ROLE your_db_user SET timezone TO 'UTC';
GRANT ALL PRIVILEGES ON DATABASE your_db_name TO your_db_user;
</code></pre></div></div>

<p>Poistu PostgreSQL-komentoriviltä:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\q
</code></pre></div></div>

<p>Luo malleja models.py-tiedostoon ja suorita migraatiot:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># myapp/models.py
from django.db import models

class MyModel(models.Model):
    name = models.CharField(max_length=100)
    value = models.IntegerField()
</code></pre></div></div>

<p>Suorita seuraavat komennot:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python manage.py makemigrations
python manage.py migrate
</code></pre></div></div>

<p>Avaa Python shell Djangossa ja testaa tietojen tallentamista:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python manage.py shell

from myapp.models import MyModel

# Luo uusi objekti
obj = MyModel(name='Test', value=123)
obj.save()  # Tallenna tietokantaan
</code></pre></div></div>

<p>Voit tarkistaa tiedot PostgreSQL komentoikkunasta:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo -u postgres psql your_db_name
SELECT * FROM myapp_mymodel;  -- Varmista, että objekti tallentui
</code></pre></div></div>

<p>————-CHATGPT vastaus loppuu ———–¢</p>

<p>Kokeilin ChatGPT vastauksia, se näytti jotenkin järkevältä mutta ei toiminut.</p>

<p><br /></p>

<p><img src="https://github.com/user-attachments/assets/c47bfeef-64e6-4c10-9707-53d889f9c623" alt="Näyttökuva 2024-9-30 kello 2 13 52" /></p>

<p>settings.py</p>

<p><img src="https://github.com/user-attachments/assets/95acbeca-402b-4052-99c4-7aa23ef8c2d5" alt="Näyttökuva 2024-9-30 kello 2 03 04" /></p>

<p>./manage.py migrate</p>

<p><img src="https://github.com/user-attachments/assets/6620fcbd-49a9-4862-9e45-25cbd5d74b79" alt="Näyttökuva 2024-9-30 kello 2 39 42" /></p>

<p>Huomasin että PostgreSQL sisällä komentojen käyttö oli vaikeata, sain usein syntaksivirheitä. Epäonnistuin luomaan käyttäjän oikealla tavalla, josta tuli myöhemmin virheitä kun yritin ajaa komennon <code class="language-plaintext highlighter-rouge">./manage.py migrate</code>. Esim.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    psycopg2. OperationalError: FATAL: password authentication dailed for user "leonardo" 
    FATAL: password authentication failed for user "leonardo"
</code></pre></div></div>

<p>[<a href="https://pimylifeup.com/raspberry-pi-postgresql/">9</a>] [<a href="https://www.postgresql.org/docs/current/user-manag.html">10</a>]</p>

<p>Näin että ongelma oli salasanassa, mutta muuten PostgreSQL pitäisi toimia. Yritän kokeilla myöhemmin uudelleen.</p>

<p>Lopetin klo 30.9 02:40</p>

<p><strong>PÄIVITYS 2.10.2024 klo 16:50</strong></p>

<p>Yritin saada PostgreSQL-tietokannan toimimaan Djangossa, ennen tuntia. En ymmärtänyt missä vika oli, vaihdoin <code class="language-plaintext highlighter-rouge">settings.py</code>-tiedostossa salasanan, olin jo kokeillut ilman salasanaa sekä salasanalla, jota varmasti käytin luodessani käyttäjän.</p>

<p>Ei onnistunut, sain edelleen saman virheviestin:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>django.db.utils.OperationalError: FATAL:  password authentication failed for user "leonardo"
FATAL:  password authentication failed for user "leonardo"
</code></pre></div></div>

<p>Kirjoitin saman virheviestin googleen, poistin oman käyttäjänimen ja kansionimen. Löysin <a href="https://stackoverflow.com/questions/43060857/postgresql-fatal-password-authentication-failed-for-user-douglas">StackOverFlow:sta</a> vastaavan kysymyksen. Ensimmäinen vastaaja ehdotti salasanan vaihtamista PostgreSQL:ssä, kokeilin sitä ensin myös:</p>

<p><img src="https://github.com/user-attachments/assets/f0b2555d-b567-4238-9a5a-b2fbaefbbd54" alt="Näyttökuva 2024-10-2 kello 17 24 24" /></p>

<p>[<a href="https://stackoverflow.com/questions/43060857/postgresql-fatal-password-authentication-failed-for-user-douglas">11</a>]</p>

<p>Suljin tietokannan, ja kokeilin <code class="language-plaintext highlighter-rouge">./manage.py makemigrations</code> uudelleen, ja sain saman virhekoodin. Tämä ei kuitenkaan toiminut, sillä syntaksini oli väärä.</p>

<p>Tietokantojen komennoissa, oikeinkirjoitus ja <code class="language-plaintext highlighter-rouge">;</code> merkki ovat tärkeitä.</p>

<p>SQL- harjoituksista oli jo vähän aikaa, ja ennenkuin tajusin edes virhettä. Päätin poistaa käyttäjän.</p>

<p>Mieleeni tuli poistaa kyseinen käyttäjä, ja luoda uusi. Näin voisin ainakin saada tietokannan toimimaan.</p>

<p>Etsin tietoa googlesta hakemalla:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Google: how to delete users in postgres
</code></pre></div></div>

<p>Löysin PosgreSQL: sivuilta <code class="language-plaintext highlighter-rouge">dropuser</code> komennon, mutta ihmettelin syntaksia, komennot olivat kirjoitettu pienellä. 
[<a href="https://www.postgresql.org/docs/current/app-dropuser.html">12</a>]</p>

<p>Avasin uudelleen tietokannan ja yritin poistaa käyttäjän <code class="language-plaintext highlighter-rouge">leonardo</code>:</p>

<p><img src="https://github.com/user-attachments/assets/8095791c-b2e5-4373-8d60-73daa5c7499a" alt="Näyttökuva 2024-10-2 kello 17 29 03" /></p>

<p>Ensin oli syntaksivirheitä, sain ne korjattua.</p>

<p>Toiseksi, en voinut poistaa käyttäjää koska siihen oli sidottu koko tietokanta.</p>

<p>Samasta kysymysketjusta löysin</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>What worked for me on AWS RDS (PostgreSQL 13) is the following:

REVOKE ALL PRIVILEGES ON DATABASE &lt;my_db&gt; FROM &lt;my_user&gt;;

I also had a similar error where the role was owner for tables so it couldn't be dropped, had to re-assign table owner with:

ALTER TABLE &lt;my_table&gt; OWNER TO &lt;trusted_role&gt;;

In fact, on RDS, AWS doesn't give you full superuser to your master user, so the following REASSIGN command fails:

REASSIGN OWNED BY &lt;olduser&gt; TO &lt;newuser&gt;;

edited May 6 at 11:34
Eddie C.'s user avatar
Eddie C.
9961010 silver badges1818 bronze badges
answered Sep 16, 2021 at 19:48
Andrew's user avatar
Andrew
</code></pre></div></div>

<p>Peruin <code class="language-plaintext highlighter-rouge">leonardo</code>-käyttäjän oikeudet, jonka jälkeen järjestelmä suostui poistamaan käyttäjän. Tarkistin vielä käyttäjän komennolla <code class="language-plaintext highlighter-rouge">\du</code></p>

<p>Käyttäjä oli poistunut onnistuneesti. Nyt voisin kokeilla uudestaan tietokannan käyttöönottoa.</p>

<p>Päätin jatkaa myöhemmin, koska tunti oli alkanut jo.</p>

<p><strong>Tunnin aikana tein seuraavan:</strong></p>

<p>Tein käyttäjän uudelleen, käytin samaa käyttäjänimeä ja salasanaa, joten <code class="language-plaintext highlighter-rouge">settings.py</code>-tiedostoa ei tarvinnut muokkaa.</p>

<p><img src="https://github.com/user-attachments/assets/f637d602-fb9b-4caf-ab30-aa210c69bc87" alt="Näyttökuva 2024-10-2 kello 19 12 02" /></p>

<p>Tällä kertaa Django käynnistyi OK, mutta sain virhekoodin <code class="language-plaintext highlighter-rouge">[02/Oct/2024 16:09:09] "GET / HTTP/1.1" 400 143</code> kun yritin avata selaimella.</p>

<p><img src="https://github.com/user-attachments/assets/b23d556e-acb9-4e9f-91a3-522cf973bcf2" alt="Näyttökuva 2024-10-2 kello 19 17 04" /></p>

<h4 id="postgresql-päivitetty">PostgreSql päivitetty</h4>

<p><strong>Päivitys 11.10.2024</strong></p>

<p>Kokeilin tehtävää uudellee, tällä kertaa Debian 12 käyttöjärjestelmällä, Intel Macbookin kanssa.</p>

<p>Olin myös perehtynyt paremmin PostgreSql kantaan ja sen komentoihin.</p>

<p>Seurasin uudestaan opettajan ohjeita. <a href="https://terokarvinen.com/2016/03/03/install-postgresql-on-ubuntu-new-user-and-database-in-3-commands/">terokarvinen.com</a></p>

<p>Tein leovice käyttäjästä superuserin, sillä olisi pitänyt pystyä tekemään tietokanta, mutta sain virheen aina kun yritin luoda taulua.</p>

<p><img src="https://github.com/user-attachments/assets/48dc8bb4-6b0f-441d-810a-9842818f3b4e" alt="Näyttökuva 2024-10-11 kello 10 32 41" /></p>

<p>Lopulta kirjauduin suoraan Superuser:na, ja pääsin heti ja helposti muokkaamaan tietokantaa.</p>

<p><img src="https://github.com/user-attachments/assets/50c31650-ff31-43b7-9a35-86eec1b94cf1" alt="Näyttökuva 2024-10-11 kello 10 20 34" /></p>

<p>Tietokannassa näkyi juuri lisätyt aiheet.</p>

<p><img src="https://github.com/user-attachments/assets/492c0790-c6d4-441d-b00b-2d65ee7361b2" alt="Näyttökuva 2024-10-11 kello 10 30 12" /></p>

<ol>
  <li>https://www.djangoproject.com/</li>
  <li>https://en.wikipedia.org/wiki/Django_(web_framework)</li>
  <li>https://www.tieturi.fi/koulutusala/ohjelmistokehitys/ohjelmoinnin-viitekehykset</li>
  <li>https://www.linux.fi/wiki/PostgreSQL</li>
  <li>https://terokarvinen.com/2022/django-instant-crm-tutorial/?fromSearch=django</li>
  <li>https://terokarvinen.com/2022/django-instant-crm-tutorial/</li>
  <li>https://stackoverflow.com/questions/20239232/django-server-error-port-is-already-in-use</li>
  <li>https://man7.org/linux/man-pages/man2/kill.2.html</li>
  <li>https://pimylifeup.com/raspberry-pi-postgresql/</li>
  <li>https://www.postgresql.org/docs/current/user-manag.html</li>
  <li>https://stackoverflow.com/questions/43060857/postgresql-fatal-password-authentication-failed-for-user-douglas</li>
  <li>https://www.postgresql.org/docs/current/app-dropuser.html</li>
</ol>

        </section>

        <footer>
            <div class="footer-content">
                <p><strong>&copy; 2025</strong></p>
            </div>
        </footer>

    </div>
</body>

</html>